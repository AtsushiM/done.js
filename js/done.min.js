/* done.js v0.1 (c) 2013 Atsushi Mizoue. */!function(){var f=!0,g=!1,k={},l=g,m=/0/.test(function(){0})?/\b_super\b/:/.*/,n,p;function q(){}function r(a,b){return Object.prototype.toString.call(b)=="[object "+a+"]"?f:g}function s(a,b){return function(){return b.apply(a,arguments)}}function t(a){return r("Array",a)?a.slice(0):a}function u(a){a.fire("complete")}function v(a){a.fire("nexttask")}
q.extend=function(a,b,c){function d(){!l&&this.init&&this.init.apply(this,arguments)}function e(c){var e=a[c],w=b.prototype[c];r("Function",e)&&r("Function",w)&&m.test(e)?d.prototype[c]=function(){var a,b=this._super;this._super=w;a=e.apply(this,arguments);this._super=b;return a}:d.prototype[c]=e}b=this;l=f;d.prototype=new b;l=g;d.prototype.constructor=d;for(c in a)a.hasOwnProperty(c)&&e(c);d.extend=b.extend;return d};
function x(a,b,c){a=a||q;a=a.extend(b);(void 0===c?g:f)&&(a.support=c);return a}
n=x(null,{dispose:function(a,b,c){a=this;for(b in a)(c=a[b])&&c.dispose&&c.dispose();a.__proto__=null;for(b in a)a[b]=null,delete a[b]},init:function(){this.e={};this.c=[]},on:function(a,b,c,d){d=this.e;d[a]||(d[a]=[]);d[a].push(b)},one:function(a,b,c,d){c=this;d=function(e){b.apply(c,e);c.off(a,d)};d.k=b;c.on(a,d)},off:function(a,b,c,d,e,h){d=this.e;if(b){if(e=d[a])for(h=e.length;h--;)if(b==e[h]||b==e[h].k)return e.splice(h,1),0==e.length&&delete d[a],f;return g}return delete d[a]},fire:y,bubble:y,
capture:function(){var a=arguments,b=this.c,c=b.length,d;if(g!==this.only.apply(this,a))for(;c--;)d=b[c],d.capture.apply(d,a)},only:function(){var a;a=[];a.push.apply(a,arguments);var b;b=a[0];r("String",b)&&(b={type:b,arguments:a,g:g,h:g,preventDefault:z,stopPropagation:A});b.before=b.target;b.target=this;var c=this.e[b.type]||[],d,e=c.length;a.splice(0,1);for(a[a.length]=b;e--;)if(d=c[e])if(d=d.apply(this,a),d===g||b.g)return d;return b},addChild:function(a){a.b&&a.b.removeChild(a);a.b=this;this.c.push(a)},
removeChild:function(a){var b=this.c,c=b.length;if(a)for(;c--;){if(b[c]===a){delete b[c].b;b.splice(c,1);break}}else for(;c--;){a=b;var d=c;delete a[d].b;a.splice(d,1)}}});function y(){var a=arguments,b=this.only.apply(this,a);if(g!==b&&!(b||k).h)(b=this.b)&&b.bubble.apply(b,a)}function z(){this.g=f}function A(){this.h=f}
p=x(n,{init:function(a,b,c){b=this;b._super();a=a||k;c=t(a.queue)||[];var d=b,e,h;for(e in a)if(h=e.match(/^on(.+)$/))d.on(h[1],a[e]);b.resetQueue(c);b.done=s(b,b.done)},start:function(a){a=this;a.fire("start");a.paused=g;a.f()},restart:function(a){this.resetQueue(a);this.start()},stop:function(){this.a=null;this.fire("stop")},pause:function(){this.paused=f;this.fire("pause")},resume:function(a){a=this;a.paused&&(a.fire("resume"),a.paused=g,a.f())},resetQueue:function(a,b,c){b=this;a&&(b.j=t(a));
a=b.a=t(b.j);for(c in a)a[c].resetQueue&&a[c].resetQueue();b.fire("reset")},d:function(){this.fire("change",this.getQueue())},setQueue:function(a){this.a=t(a);this.d()},getQueue:function(){return t(this.a)},addTask:function(a,b,c){c=this;if(!r("Number",b)||b>c.a.length)b=c.a.length;c.a.splice(b,0,a);c.d()},removeTask:function(a,b,c,d){b=this;c=0;for(d=b.a.length;c<d;c++)if(b.a[c]===a){b.a.splice(c,1);b.d();break}},f:function(){this.paused||this.exe()},exe:function(a,b,c){a=this;if(b=a.a.shift())return b.one&&
b.start?(b.one("nexttask",a.done),c=s(b,b.start)):c=r("Function",b)&&b.length?s(a,b):function(c){b.call(a);c()},c(a.done)}},void 0);p.Parallel=p.Async=x(p,{exe:function(a){a=this;if(a.a){if(!a.a.length)return u(a),v(a);for(a.i=a.a.length;!a.paused&&a.a&&a.a[0];)a._super()}},done:function(a){a=this;a.fire("progress");a.i--;a.i||(u(a),v(a))}});p.Serial=p.Sync=x(p,{exe:function(a){a=this;if(a.a&&!a.paused){if(a.a[0])return a._super();u(a);v(a)}},done:function(){this.fire("progress");this.exe()}});
Done=p;}();
