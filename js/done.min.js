/* done.js v1.0 (c) 2013 Atsushi Mizoue. */!function(){var f=!0,g=!1,h,l,m,n,p,q,r,s,t,u,v,w,x,y,z,A,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q={}.hasOwnProperty;M="undefined"===typeof module?window:module.exports;m={};y=g;x=/0/.test(function(){0})?/\b_super\b/:/.*/;l=function(){};P=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"?f:g};K=function(a){return P("Number",a)};L=function(a){return P("String",a)};H=function(a){return P("Array",a)};J=function(a){return P("Function",a)};I=function(a){return void 0===a?g:f};
N=function(a,b){return function(){return b.apply(a,arguments)}};O=function(a){var b;b=[];b.push.apply(b,a);return b};z=function(a){return H(a)?a.slice(0):a};A=function(a,b){a.splice(b,1)};v=function(a,b){var c,d,e;for(c in b)if(e=b[c],d=c.match(/^on(.+)$/))a.on(d[1],e)};G=function(a){return!(!J(a)||!a.length)};C=function(a){a.emit("complete")};D=function(a){a.emit("nexttask")};F=function(a){a.emit("start")};E=function(a){a.emit("progress")};
l.extend=function(a){var b,c,d;b=this;l=function(){!y&&this.init&&this.init.apply(this,arguments)};c=function(c){var d,k;d=a[c];k=b.prototype[c];J(d)&&J(k)&&x.test(d)?l.prototype[c]=function(){var a,b;b=this._super;this._super=k;a=d.apply(this,arguments);this._super=b;return a}:l.prototype[c]=d};y=f;l.prototype=new b;y=g;l.prototype.constructor=l;for(d in a)Q.call(a,d)&&c(d);l.extend=b.extend;return l};w=function(a,b,c){a=a||l;a=a.extend(b);I(c)&&(a.support=c);return a};
t=function(a,b){delete a[b].b;A(a,b)};p=function(){var a,b,c;a=O(arguments||[]);b=a[2];a=a.slice(0,2);c=this.only.apply(this,a);if(g!==c&&!(c||{}).h)(c=this.b)&&c.bubble.apply(c,a);r(b)};r=function(a){J(a)&&a.apply(this)};s=function(){this.g=f};u=function(){this.h=f};q=function(a,b){var c;c=b[0];L(c)&&(c={type:c,arguments:b,g:g,h:g,preventDefault:s,stopPropagation:u});c.before=c.target;c.target=a;return c};
n=l.extend({init:function(){this.e={};return this.c=[]},dispose:function(){var a,b;this.removeChild;for(a in this)(b=this[a])&&b.dispose&&b.dispose;this.__proto__=null;for(a in this)this[a]=null,delete this[a]},on:function(a,b){var c;c=this.e;c[a]||(c[a]=[]);c[a].push(b)},one:function(a,b){var c,d=this;c=function(){b.apply(d,arguments);d.off(a,c)};c.k=b;this.on(a,c)},off:function(a,b){var c,d,e,B,k;d=this.e;if(b){if(e=d[a])for(c=k=e.length-1;0<=k;c=k+=-1)if(B=e[c],b===B||b===B.k)return A(e,c),0===
e.length&&delete d[a],f;return g}return delete d[a]},emit:p,bubble:p,capture:function(){var a,b,c,d,e;a=O(arguments);b=a[2];c=this.c;a=a.slice(0,2);if(g!==this.only.apply(this,a))for(e=c.length-1;0<=e;e+=-1)d=c[e],d.capture.apply(d,a);r(b)},only:function(){var a,b,c,d,e;a=O(arguments);b=q(this,a);c=this.e[b.type]||[];a[0]=b;for(e=c.length-1;0<=e;e+=-1)if(d=c[e])if(d=d.apply(this,a),d===g||b.g)return d;r(a[2]);return b},addChild:function(a){a.b&&a.b.removeChild(a);a.b=this;this.c.push(a)},removeChild:function(a){var b,
c,d;b=this.c;if(a)for(c=d=b.length-1;0<=d;c=d+=-1){if(b[c]===a){t(b,c);break}}else for(c=a=b.length-1;0<=a;c=a+=-1)t(b,c)}});
h=w(n,{init:function(a){var b;this._super();a=a||m;b=z(a.queue||[]);v(this,a);this.resetQueue(b);this.done=N(this,this.done)},start:function(){F(this);this.paused=g;this.f()},restart:function(a){this.resetQueue(a);this.start()},stop:function(){this.a=null;this.emit("stop")},pause:function(){this.paused=f;this.emit("pause")},resume:function(){this.paused&&(this.emit("resume"),this.paused=g,this.f())},resetQueue:function(a){var b;a&&(this.j=z(a));a=this.a=z(this.j);for(b in a)a[b].resetQueue&&a[b].resetQueue();
this.emit("reset")},d:function(){this.emit("change",this.getQueue())},setQueue:function(a){this.a=z(a);this.d()},getQueue:function(){return z(this.a)},addTask:function(a,b){if(!K(b)||b>this.a.length)b=this.a.length;this.a.splice(b,0,a);this.d()},removeTask:function(a){var b,c,d;d=this.a;b=c=0;for(d=d.length;c<d;b=++c)if(this.a[b]===a){A(this.a,b);this.d();break}},f:function(){this.paused||this.exe()},exe:function(){var a,b,c=this;if(b=this.a.shift())return b.one&&b.start?(b.one("nexttask",this.done),
a=N(b,b.start)):a=G(b)?N(this,b):function(a){b.call(c);a()},a(this.done)}},void 0);h.Parallel=h.Async=w(h,{exe:function(){if(this.a){if(!this.a.length)return C(this),D(this);for(this.i=this.a.length;!this.paused&&this.a&&this.a[0];)this._super()}},done:function(){E(this);this.i--;this.i||(C(this),D(this))}});h.Serial=h.Sync=w(h,{exe:function(){if(this.a&&!this.paused){if(this.a[0])return this._super();C(this);D(this)}},done:function(){E(this);this.exe()}});M.Done=h;}();
