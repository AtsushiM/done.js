/* done.js v0.1 (c) 2013 Atsushi Mizoue. */!function(){var f=!0,g=!1,h,l,m,n,p,q,r,s,t,u,v,w,x,y,z,B,C,D,E,F,G,H,I,J,K,L,M,N,O={}.hasOwnProperty;m={};x=g;w=/0/.test(function(){0})?/\b_super\b/:/.*/;l=function(){};N=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"?f:g};J=function(a){return N("Number",a)};K=function(a){return N("String",a)};G=function(a){return N("Array",a)};I=function(a){return N("Function",a)};H=function(a){return void 0===a?g:f};L=function(a,b){return function(){return b.apply(a,arguments)}};
M=function(a){var b;b=[];b.push.apply(b,a);return b};y=function(a){return G(a)?a.slice(0):a};z=function(a,b){a.splice(b,1)};u=function(a,b){var c,d,e;for(c in b)if(e=b[c],d=c.match(/^on(.+)$/))a.on(d[1],e)};F=function(a){return!(!I(a)||!a.length)};B=function(a){a.fire("complete")};C=function(a){a.fire("nexttask")};E=function(a){a.fire("start")};D=function(a){a.fire("progress")};
l.extend=function(a){var b,c,d;b=this;l=function(){!x&&this.init&&this.init.apply(this,arguments)};c=function(c){var d,k;d=a[c];k=b.prototype[c];I(d)&&I(k)&&w.test(d)?l.prototype[c]=function(){var a,b;b=this._super;this._super=k;a=d.apply(this,arguments);this._super=b;return a}:l.prototype[c]=d};x=f;l.prototype=new b;x=g;l.prototype.constructor=l;for(d in a)O.call(a,d)&&c(d);l.extend=b.extend;return l};v=function(a,b,c){a=a||l;a=a.extend(b);H(c)&&(a.support=c);return a};
s=function(a,b){delete a[b].b;z(a,b)};p=function(){var a,b;a=M(arguments||[]);b=this.only.apply(this,a);if(g!==b&&!(b||{}).h)(b=this.b)&&b.bubble.apply(b,a)};r=function(){return this.g=f};t=function(){return this.h=f};q=function(a,b){var c;c=b[0];K(c)&&(c={type:c,arguments:b,g:g,h:g,preventDefault:r,stopPropagation:t});c.before=c.target;c.target=a;return c};
n=l.extend({init:function(){this.e={};return this.c=[]},dispose:function(){var a,b;this.removeChild;for(a in this)(b=this[a])&&b.dispose&&b.dispose;this.__proto__=null;for(a in this)this[a]=null,delete this[a]},on:function(a,b){var c;c=this.e;c[a]||(c[a]=[]);c[a].push(b)},one:function(a,b){var c,d=this;c=function(){b.apply(d,arguments);d.off(a,c)};c.k=b;this.on(a,c)},off:function(a,b){var c,d,e,A,k;d=this.e;if(b){if(e=d[a])for(c=k=e.length-1;0<=k;c=k+=-1)if(A=e[c],b===A||b===A.k)return z(e,c),0===
e.length&&delete d[a],f;return g}return delete d[a]},fire:p,bubble:p,capture:function(){var a,b,c,d;a=arguments;b=this.c;if(g!==this.only.apply(this,a))for(d=b.length-1;0<=d;d+=-1)c=b[d],c.capture.apply(c,a)},only:function(){var a,b,c,d,e;a=M(arguments);b=q(this,a);c=this.e[b.type]||[];z(a,0);a[a.length]=b;for(e=c.length-1;0<=e;e+=-1)if(d=c[e])if(d=d.apply(this,a),d===g||b.g)return d;return b},addChild:function(a){a.b&&a.b.removeChild(a);a.b=this;this.c.push(a)},removeChild:function(a){var b,c,d;
b=this.c;if(a)for(c=d=b.length-1;0<=d;c=d+=-1){if(b[c]===a){s(b,c);break}}else for(c=a=b.length-1;0<=a;c=a+=-1)s(b,c)}});
h=v(n,{init:function(a){var b;this._super();a=a||m;b=y(a.queue||[]);u(this,a);this.resetQueue(b);this.done=L(this,this.done)},start:function(){E(this);this.paused=g;this.f()},restart:function(a){this.resetQueue(a);this.start()},stop:function(){this.a=null;this.fire("stop")},pause:function(){this.paused=f;this.fire("pause")},resume:function(){this.paused&&(this.fire("resume"),this.paused=g,this.f())},resetQueue:function(a){var b;a&&(this.j=y(a));a=this.a=y(this.j);for(b in a)a[b].resetQueue&&a[b].resetQueue();
this.fire("reset")},d:function(){this.fire("change",this.getQueue())},setQueue:function(a){this.a=y(a);this.d()},getQueue:function(){return y(this.a)},addTask:function(a,b){if(!J(b)||b>this.a.length)b=this.a.length;this.a.splice(b,0,a);this.d()},removeTask:function(a){var b,c,d;d=this.a;b=c=0;for(d=d.length;c<d;b=++c)if(this.a[b]===a){z(this.a,b);this.d();break}},f:function(){this.paused||this.exe()},exe:function(){var a,b,c=this;if(b=this.a.shift())return b.one&&b.start?(b.one("nexttask",this.done),
a=L(b,b.start)):a=F(b)?L(this,b):function(a){b.call(c);a()},a(this.done)}},void 0);h.Parallel=h.Async=v(h,{exe:function(){if(this.a){if(!this.a.length)return B(this),C(this);for(this.i=this.a.length;!this.paused&&this.a&&this.a[0];)this._super()}},done:function(){D(this);this.i--;this.i||(B(this),C(this))}});h.Serial=h.Sync=v(h,{exe:function(){if(this.a&&!this.paused){if(this.a[0])return this._super();B(this);C(this)}},done:function(){D(this);this.exe()}});window.Done=h;}();
